trigger_mode(TRIGGER_MODE_MANUAL)

local('./mvnw clean install')

docker_build('spring', '.')

docker_build('spring-wiremock', 'kustomize/environment/local/wiremock/image')

k8s_yaml(kustomize('kustomize/environment/local'))

k8s_resource(
    workload='spring',
    port_forwards=[port_forward(local_port=8080, container_port=8080, name='http')]
)

k8s_resource(workload='spring-database', port_forwards=5432)
k8s_resource(workload='spring-wiremock', port_forwards=8888)
